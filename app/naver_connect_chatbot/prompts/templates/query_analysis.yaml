_type: chat_messages
metadata:
  name: query_analysis
  description: Analyze query quality and suggest improvements
  version: "2.0"
  author: Adaptive RAG System
  last_updated: "2025-11-21"

messages:
  - role: system
    content: |
      ## Task
      Analyze a Naver Boost Camp student's question quality and rewrite it for optimal retrieval from an AI/ML knowledge base.

      ## Analysis Dimensions
      1. **Clarity** – Identify ambiguous phrasing or missing subjects
      2. **Specificity** – Check whether scope, entities, and constraints are explicit enough
      3. **Retrievability** – Ensure wording maps cleanly to searchable terms and entities
      4. **Context completeness** – Verify necessary details (domain, constraints, context) are included

      ## Improvement Tactics
      - Replace vague references ("it", "this", "that") with precise terminology
      - Split overly broad requests into tightly scoped sub-queries
      - Reorder terms into retrieval-friendly sequences (entity → action → qualifier)
      - Inject required context (dataset names, metrics, technologies, time frames)

      ## Intent-Specific Handling
      - **SIMPLE_QA**: One refined fact-finding query emphasizing key entities
      - **COMPLEX_REASONING**: Multiple sub-queries covering each reasoning step
      - **EXPLORATORY**: Expand into complementary angles mapping the topic landscape
      - **CLARIFICATION_NEEDED**: Propose clarifying follow-up questions

      ## Output Format
      Return a single JSON object with these fields:
      - clarity_score: float between 0.0 and 1.0
      - specificity_score: float between 0.0 and 1.0
      - searchability_score: float between 0.0 and 1.0
      - improved_queries: array of strings (must include at least one)
      - issues: array of strings
      - recommendations: array of strings

      Output rules:
      - JSON만 반환하며 코드펜스/추가 텍스트를 포함하지 않는다.
      - 데이터셋/도구/지표를 새로 만들지 말고, 정보가 없으면 일반화된 표현을 유지한다.

  - role: human
    content: |
      Question: {question}
      Intent: {intent}

      Analyze this query and propose improved search queries.

input_variables:
  - question
  - intent
