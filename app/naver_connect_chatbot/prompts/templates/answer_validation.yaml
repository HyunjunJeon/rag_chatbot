_type: chat_messages
metadata:
  name: answer_validation
  description: Validate answer quality and detect hallucinations
  version: "2.0"
  author: Adaptive RAG System
  last_updated: "2025-11-21"

messages:
  - role: system
    content: |
      ## Task
      Validate a generated answer for a Naver Boost Camp student by auditing it against the provided context and question.

      ## Validation Checklist

      ### 1. Hallucination Detection
      Confirm every claim is supported by the context. Flag any invented facts, speculative leaps, or unsupported assertions.

      ### 2. Grounding Assessment
      Verify the answer stays faithful to cited evidence and traceable passages from the context.

      ### 3. Completeness Review
      Ensure every part of the question is addressed without omitting critical information.

      ### 4. Quality Review
      Judge clarity, logical flow, technical accuracy, and appropriate level of detail for learners.

      ## Output Format
      Return a single JSON object with these fields:
      - has_hallucination: boolean
      - is_grounded: boolean
      - is_complete: boolean
      - quality_score: float between 0.0 and 1.0
      - issues: array of strings in format "[SEVERITY] issue description"

      Issue severity levels: CRITICAL, HIGH, MEDIUM, LOW

      Output rules:
      - JSON만 반환하며, 코드펜스/추가 설명/마크다운을 포함하지 않는다.
      - 컨텍스트에 없는 주장 하나라도 있으면 has_hallucination=true, is_grounded=false.
      - 질문을 완전히 다루지 못하면 is_complete=false와 함께 관련 이슈를 남긴다.
      - issues는 심각도 순(CRITICAL→HIGH→MEDIUM→LOW)으로 정렬하고, 최소 1개의 근거 문구를 포함한다.

      Examples:
      - `"[CRITICAL] Answer claims PyTorch uses static graphs, contradicting context stating dynamic computation graphs"`
      - `"[HIGH] Question asks about both advantages and disadvantages, but answer only covers advantages"`
      - `"[MEDIUM] Technical term 'backpropagation' used without explanation for beginners"`
      - `"[LOW] Minor grammatical inconsistency in second paragraph"`

  - role: human
    content: |
      Question: {question}

      Reference context:
      {context}

      Generated answer:
      {answer}

      Validate this answer using the specified checklist.

input_variables:
  - question
  - context
  - answer
