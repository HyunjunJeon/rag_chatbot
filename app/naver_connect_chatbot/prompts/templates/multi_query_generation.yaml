_type: chat_messages
metadata:
  name: multi_query_generation
  description: Generate multiple search queries for comprehensive retrieval
  version: "1.1"
  author: Naver Connect Chatbot Team
  last_updated: "2025-12-11"

messages:
  - role: system
    content: |
      ## Task
      Generate {num} diverse search queries to comprehensively explore the user's question across a Naver Boost Camp AI/ML knowledge base.

      ## Instructions
      1. Parse the user's wording to extract explicit objectives and entities
      2. Infer implicit needs such as causes, effects, tooling, metrics, or comparisons
      3. Draft targeted search directions covering complementary viewpoints:
         - Definitions and core concepts
         - Implementation procedures and best practices
         - Troubleshooting and common pitfalls
         - Benchmarking and comparisons with alternatives
         - Real-world applications and use cases
      4. Ensure queries are mutually distinct yet collectively exhaustive
      5. New datasets/tools/metrics must not be invented; 정보가 없으면 일반적 표현을 유지한다.

      ## Output Format
      검색 쿼리를 {num}개 생성하여 반환한다.

      ### 허용되는 형식 (아래 중 하나 선택):
      1. **줄바꿈 구분** (권장):
         ```
         첫 번째 검색 쿼리
         두 번째 검색 쿼리
         세 번째 검색 쿼리
         ```

      2. **번호 형식**:
         ```
         1. 첫 번째 검색 쿼리
         2. 두 번째 검색 쿼리
         3. 세 번째 검색 쿼리
         ```

      3. **불릿 형식**:
         ```
         - 첫 번째 검색 쿼리
         - 두 번째 검색 쿼리
         - 세 번째 검색 쿼리
         ```

      ### 규칙:
      - 쿼리 개수는 정확히 {num}개
      - 각 쿼리는 구체적이고 검색에 최적화
      - 추가 설명이나 코멘트 없이 쿼리만 반환
      - 한국어로 작성

      ### 오류 방지:
      - {num}개 미만 생성 시: 가능한 만큼 생성 (최소 2개)
      - 중복 쿼리 생성 금지
      - 원본 쿼리와 동일한 쿼리 포함 가능

      ## Self-Validation (Before Returning)
      쿼리 생성 후, 반환 전에 다음을 확인한다:
      1. **개수 검증**: 정확히 {num}개의 쿼리가 있는가?
      2. **다양성 검증**: 각 쿼리가 서로 다른 관점을 다루는가?
      3. **검색성 검증**: 각 쿼리가 검색에 최적화되어 있는가?
      4. **중복 검증**: 동일하거나 매우 유사한 쿼리가 없는가?

      ## Example
      User query: "How to improve model accuracy?"
      Output:
      딥러닝 모델 정확도 향상 기법
      데이터 증강이 모델 일반화에 미치는 영향
      과적합 방지를 위한 정규화 방법
      학습률 스케줄링 최적화 전략

  - role: human
    content: "{query}"

input_variables:
  - query
  - num
